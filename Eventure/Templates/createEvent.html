{% extends "Base.html" %}
{% load staticfiles %}

{% block body_block %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Event</title>
    <link rel="stylesheet" href="{% static 'css/createEvent.css' %}"/>
</head>
<body>

<script type="text/html" id="item-template">
    <div id="item-__prefix__">
        {{ itemCreationFormset.empty_form }}
    </div>
</script>

<script type="text/html" id="invitee-template">
    <div id="invitee-__prefix__">
        {{ inviteToEventFormset.empty_form }}
    </div>
</script>

<!-- Nav tabs -->
<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#EventInfo">Event Info</a></li>
    <li><a data-toggle="tab" href="#inviteList">Invite List</a></li>
    <li><a data-toggle="tab" href="#itemList">Item List</a></li>
  </ul>


<form enctype="multipart/form-data" method="POST" id="SigningUp">
    <div class="tab-content">
        {% csrf_token %}

        <!-- First Tab -->
        <div id="EventInfo" class="tab-pane fade in active">
            <table class="table">
                    {{ eventForm.as_table }}
            </table>
            <br/>
            <div id="NavButtons">
                <a class="btn btn-primary btnNext">Next</a>
            </div>
        </div>

        <!-- Second Tab -->
        <div id="inviteList" class="tab-pane fade">
            <h3>Who would you like to invite?</h3>
            <!-- InviteList management_form -->
            {{ inviteToEventFormset.management_form }}
            <div id="invitees-form-container">
                {% for invitee in inviteToEventFormset %}
                    <div id="invitee-{{ forloop.counter0 }}" class="inviteTable">
                        {{ invitee.as_table }}
                    </div>
                {% endfor %}
            </div>

            <div class="NavButtons">
                <a class="btn btn-primary btnPrevious">Previous</a>
                <a href="#" id="invitee-item-button" class="btn btn-info add-invitee">Add Invitee</a>
                <a class="btn btn-primary btnNext">Next</a>
            </div>
        </div>

        <!-- Third Tab -->
        <div id="itemList" class="tab-pane fade">
            <!-- ItemList management_form -->
            {{ itemCreationFormset.management_form }}
            <h3>What would you like people to bring?</h3>
            <div id="items-form-container" class="itemTable">
                {% for items in itemCreationFormset %}
                    <div id="item-{{ forloop.counter0 }}" class="itemTable ">
                        {{ items }}
                    </div>
                {% endfor %}
            </div>

            <div class="NavButtons">
                <a class="btn btn-primary btnPrevious">Previous</a>
                <a href="#" id="add-item-button" class="btn btn-info add-item">Add Item</a>
                <br/>
                <input id="submitButton" type="submit" class="btn btn-warning" value="Create Event">
            </div>


        </div>
    </div>
</form>

<script>
$(document).ready(function() {
    $('.add-item').click(function(ev) {
        ev.preventDefault();
        var count = $('#items-form-container').children().length;
        var tmplMarkup = $('#item-template').html();
        var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);

        $('div#items-form-container').append(compiledTmpl);
        $('div#items-form-container [id^=item-]').addClass("itemTable");

        // update form count
        $('#id_item-TOTAL_FORMS').attr('value', count+1);
    });
});

$(document).ready(function() {
    $('.add-invitee').click(function(ev) {
        ev.preventDefault();
        var count = $('#invitees-form-container').children().length;
        var tmplMarkup = $('#invitee-template').html();
        var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);

        $('div#invitees-form-container').append(compiledTmpl);
        $('div#invitees-form-container [id^=invitee-]').addClass("inviteTable");

        // update form count
        $('#id_invitee-TOTAL_FORMS').attr('value', count+1);
        addValidationRules();

    });
});

$(document).ready(function (){
      highLightBox();
});

$(document).ready(function() {

     var validator = $("#SigningUp").validate({
      onkeyup: function (element, event) {
            if (event.which === 9 && this.elementValue(element) === "") {
                return;
            } else {
                this.element(element);
            }
      },
      rules: {
        name: {
            required: true,
            minlength: 6
        },
        location : "required",
        date : {
            required: true,
            date: true
        },
        time :{
            required : true,
            timeAMPM : true
        },
      },
      message: {
          name:{
              required : "This field is required",
              minlength : "Name has to be at least 6 characters"
          },
          time: {
              timeAMPM : "Please enter a valid time"
          },

      }
    });
    validator.invalidElements();
    addValidationRules();
});

function addValidationRules(){
     $('[name$="-email"]').each(function() {
         $(this).rules('add', {
             EmailWithDot: true
         });
     });
}

function highLightBox(){
    $('.errorlist').parent().each(function(){
        $(this).children(':input').addClass('form-control')
        $(this).addClass('has-error')
     });
}

jQuery.validator.addMethod("EmailWithDot", function(value, element) {
    return this.optional( element ) || ( /^[a-z0-9]+([-._][a-z0-9]+)*@([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,4}$/
        .test( value ) && /^(?=.{1,64}@.{4,64}$)(?=.{6,100}$).*/.test( value ) );
}, 'Not a valid email address.');

jQuery.validator.addMethod("timeAMPM", function(value, element) {
    return this.optional( element ) || ( /^[01]?[0-9]:[0-6]{2}[a,p]m$/.test( value ) );
}, 'Please enter a valid time');

$(function () {
      $('#myTab a:last').tab('show')
  })

$('.btnNext').click(function(){
    $('.nav-tabs > .active').next('li').find('a').trigger('click');

});
$('.btnPrevious').click(function(){
    $('.nav-tabs > .active').prev('li').find('a').trigger('click');

});

</script>
    {% endblock %}

</body>
</html>